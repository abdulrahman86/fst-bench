# Spark Benchmark Suite (SparkBench) #
## SparkBench - the micro-benchmark suite for Spark ##

---

**<font color='red'>WARNING: UNDER CONSTRUCTION</font>**

- Current version: 0.1
- Release data: TBD
- Contact: [Lv Qi](mailto:qi.lv@intel.com), [Grace Huang](mailto:jie.huang@intel.com)
- Homepage: https://github.com/intel-bigdata/Sparkbench

- Contents:
  1. Overview
  2. Getting Started
  3. Running

---
### OVERVIEW ###

This benchmark suite contains 9 typical micro workloads:

  **Spark Core:**

1. Sort (sort)

    This workload sorts its *text* input data, which is generated using the Hadoop RandomTextWriter example.

2. WordCount (wordcount)

    This workload counts the occurrence of each word in the input data, which are generated using the Hadoop RandomTextWriter example. It is representative of another typical class of real world MapReduce jobs - extracting a small amount of interesting data from large data set.

3. Sleep (sleep)

    TeraSort is a standard benchmark created by Jim Gray. Its input data is generated by Hadoop TeraGen example program.

  **Spark SQL:**

4. Scan (scan)

    Enhanced DFSIO tests the HDFS throughput of the Hadoop cluster by generating a large number of tasks performing writes and reads simultaneously. It measures the average I/O rate of each map task, the average throughput of each map task, and the aggregated throughput of HDFS cluster.

5. Join (join)

6. Aggregate (aggregation)

  **Spark Graphx:**

7. PageRank (pagerank)

    The workloads contains an implementation of the PageRank algorithm on Hadoop (a search engine ranking benchmark included in pegasus 2.0). The workload uses the automatically generated Web data whose hyperlinks follow the Zipfian distribution.

  **Spark MLLib:**

8. Bayesian Classification (bayes)

    Large-scale machine learning is another important use of MapReduce. This workload tests the Naive Bayesian (a popular classification algorithm for knowledge discovery and data mining) trainer in Mahout 0.7, which is an open source (Apache project) machine learning library. The workload uses the automatically generated documents whose words follow the zipfian distribution. The dict used for text generation is also from the default linux file /usr/share/dict/linux.words.

9. K-means clustering (kmeans)

    This workload tests the K-means (a well-known clustering algorithm for knowledge discovery and data mining) clustering in Mahout 0.7. The input data set is generated by GenKMeansDataset based on Uniform Distribution and Guassian Distribution.

---
### Getting Started ###

2. Prerequisites

  1. Setup HiBench-2.2

      Download/checkout HiBench-2.2 benchmark suite from [https://github.com/intel-hadoop/HiBench/zipball/HiBench-2.2](https://github.com/intel-hadoop/HiBench/zipball/HiBench-2.2). Use etl-comm branch

  2. Setup Hadoop

      Before you run any workload in the package, please verify the Hadoop framework is running correctly. All the workloads have been tested with Cloudera Distribution of Hadoop 3 update 4 (cdh3u4) and Hadoop version 1.0.3

  3. Setup Spark

      Please make sure you have properly set up Hive in your cluster if you want to test hivebench. Or the benchmark willuse the default Hive-0.9 release which is included in package.

  4. Setup SparkBench

      Download/checkout SparkBench benchmark suite from [https://github.com/intel-bigdata/Sparkbench](https://github.com/Intel-bigdata/Sparkbench/archive/master.zip)

  5. Setup numpy for Python related MLLib operations

2. Configure for the all workloads

    You need to set some global environment variables in the `bin/hibench-config.sh` file located in the root dir.

          HADOOP_HOME            < The Hadoop installation location >
          HADOOP_CONF_DIR        < The hadoop configuration DIR >
          HADOOP_EXAMPLES_JAR    < The path to hadoop-examples-xxx.jar >
          SPARK_HOME             < The Spark installation location >
          SPARK_CONF_DIR         < The Spark config DIR >
          SPARK_EXAMPLES_JAR     < The path to spark-examples-xxx.jar >
          DICT_PATH              < The dict location >
          DATA_PATH              < The base HDFS path to hold HiBench data >
          SPARKBENCH_REPORT      < The path to SparkBench reports >

    Note:
      i.  HiBench will guess the value of these variables if they are not explicitly set. If so, HiBench guarantees neither the correctness of guess nor the success running of benchmarks.
      ii. Do not change the default values of other global environment variables unless necessary.

3. Configure each workload

    You can modify the `conf/configure.sh` file under each workload folder if it exists. All the data size and options related to the workload are defined in this file.

4. Synchronize the time on all nodes (This is optional)

5. Build

    You will need to execute `bin/build-all.sh` to build all workloads. (Assume `sbt` is installed properly and accessible in $PATH)

---
### Running ###

- Run several workloads together

  The `conf/benchmarks.lst` file under the package folder defines the workloads to run when you execute the `bin/run-all.sh` script under the package folder. Each line in the list file specifies one workload. You can use `#` at the beginning of each line to skip the corresponding bench if necessary.

- Run each workload separately

  You can also run each workload separately. In general, there are 3 different files under one workload folder.

        conf/configure.sh       Configuration file contains all parameters such as data size and test options.
        bin/prepare*.sh   Generate or copy the job input data into HDFS.
        bin/run*.sh       Execute the workload

  Follow the steps below to run a workload

  1. Configure the benchmark:

      set your own configurations by modifying `configure.sh` if necessary
  2. Prepare data:

      `bin/prepare.sh` (`bin/prepare-read.sh` for dfsioe) to prepare input data in HDFS for running the benchmark
  3. Run the benchmark:

      `bin/run*.sh` to run the corresponding benchmark
